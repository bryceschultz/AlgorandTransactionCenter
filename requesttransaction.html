<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="algosdk.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="style.css">
<body>

<div class="bgimg">
  <div class="middle">
    <h2>Request</h2>
    <input id="transactionAmount" type="number">
    <p>Algos (0.1 minimum)</p>
    <br>
    <h2>From</h2>
    <input id="requestFromEmail" type="text" placeholder="Email">
    <p>Request from this email address</p>
    <br>
    <h2>To</h2>
    <input id="requestToEmailOrAlgoAddress" type="text">
    <p>Fulfill request to this email or algorand address</p>
    <br>
    <h2>Add a note</h2>
    <textarea id="requestNote" type="text"></textarea>
    <br>
    <br>
    <br>
    <button id="submitRequest" class="button" width="60" height="100">submit request</button>
  </div>
  
  <!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <p id="emailSent"></p>
  </div>
  </div>
    
  </div>
</div>
  
<script>  
  
  // Get the modal
var modal = document.getElementById("myModal");
  
  
  function sendRequest(requestToEmailOrAlgoAddress, requestFromEmail, transactionAmount, requestNote) {
    var postString = "https://algorandtransactioncenter.herokuapp.com/postRequestTransaction?transactionAmountInAlgos="+transactionAmount+"&requestToEmailOrAlgoAddress="+requestToEmailOrAlgoAddress+"&requestFromEmail="+requestFromEmail+"&requestNote="+requestNote;    
    var form = new FormData();
    var settings = {
    "url": postString,
    "method": "POST",
    "timeout": 0,
    "processData": false,
    "mimeType": "multipart/form-data",
    "contentType": false,
    "data": form
  };

  $.ajax(settings).done(function (response) {
    console.log(response);
    var respObj = JSON.parse(response);
    if (respObj.emailSent == true) {
      $('#emailSent').text('Request has been sent to: ' + requestFromEmail);
    } else {
      $('#emailSent').text('We were not able to send the email. Please reload the page and try again.');
    }
  });
  }

var btn = document.getElementById("submitRequest");

// When the user clicks on the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
  var requestToEmailOrAlgoAddress = document.getElementById("requestToEmailOrAlgoAddress").value;
  console.log(requestToEmailOrAlgoAddress);
  var requestFromEmail = document.getElementById("requestFromEmail").value;
  console.log(requestFromEmail);
  var transactionAmount = document.getElementById("transactionAmount").value;
  console.log(transactionAmount);
  var requestNote = document.getElementById("requestNote").value;
  console.log(requestNote);
  var transactionResult = sendRequest(requestToEmailOrAlgoAddress, requestFromEmail, transactionAmount, requestNote);
}
  
</script>
</body>
</html>
